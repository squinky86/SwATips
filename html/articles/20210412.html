<!DOCTYPE html>
<html xml:lang='en-US' lang='en-US'>
<head>
<title>Sticking with a RAII Standard</title>
 

<meta charset="utf-8"/>
 

<meta content="TeX4ht (https://tug.org/tex4ht/)" name="generator"/>
 

<meta content="width=device-width,initial-scale=1" name="viewport"/>
 

 

<meta content="article.tex" name="src"/>
 

<script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4110907817782130" crossorigin="anonymous"></script>
<style>
 
/* start css.sty */
.rm-lmbx-12x-x-144{font-size:172%; font-weight: bold;}
.rm-lmr-12{font-size:120%;}
.rm-lmr-9{font-size:90%;}
.ec-lmtt-10{ font-family: monospace,monospace;}
.ec-lmtt-10{ font-family: monospace,monospace;}
.ec-lmtt-10{ font-family: monospace,monospace;}
.ec-lmtt-10{ font-family: monospace,monospace;}
.rm-lmr-8{font-size:80%;}
.rm-lmri-10{ font-style:italic;}
.ec-lmtt-9{font-size:90%; font-family: monospace,monospace;}
.ec-lmtt-9{ font-family: monospace,monospace;}
.ec-lmtt-9{ font-family: monospace,monospace;}
.ec-lmtt-9{ font-family: monospace,monospace;}
.ec-lmtk-10x-x-90{font-size:90%; font-family: monospace,monospace;}
.ec-lmtk-10x-x-90{ font-family: monospace,monospace;}
.ec-lmtk-10x-x-90{ font-family: monospace,monospace;}
.ec-lmtk-10x-x-90{ font-family: monospace,monospace;}
.ts1-lmtt9-{font-size:90%;}
.ec-lmtti-10x-x-90{font-size:90%; font-family: monospace,monospace; font-style:italic;}
.ec-lmtti-10x-x-90{ font-family: monospace,monospace; font-style:italic;}
.ec-lmtti-10x-x-90{ font-family: monospace,monospace; font-style:italic;}
.ec-lmtti-10x-x-90{ font-family: monospace,monospace; font-style:italic;}
.rm-lmcsc-10{font-variant: small-caps;}
p{margin-top:0;margin-bottom:0}
p.indent{text-indent:0;}
p + p{margin-top:1em;}
p + div, p + pre {margin-top:1em;}
div + p, pre + p {margin-top:1em;}
a { overflow-wrap: break-word; word-wrap: break-word; word-break: break-word; hyphens: auto; }
@media print {div.crosslinks {visibility:hidden;}}
a img { border-top: 0; border-left: 0; border-right: 0; }
center { margin-top:1em; margin-bottom:1em; }
td center { margin-top:0em; margin-bottom:0em; }
.Canvas { position:relative; }
img.math{vertical-align:middle;}
div.par-math-display, div.math-display{text-align:center;}
li p.indent { text-indent: 0em }
li p:first-child{ margin-top:0em; }
li p:last-child, li div:last-child { margin-bottom:0.5em; }
li p~ul:last-child, li p~ol:last-child{ margin-bottom:0.5em; }
.enumerate1 {list-style-type:decimal;}
.enumerate2 {list-style-type:lower-alpha;}
.enumerate3 {list-style-type:lower-roman;}
.enumerate4 {list-style-type:upper-alpha;}
div.newtheorem { margin-bottom: 2em; margin-top: 2em;}
.obeylines-h,.obeylines-v {white-space: nowrap; }
div.obeylines-v p { margin-top:0; margin-bottom:0; }
.overline{ text-decoration:overline; }
.overline img{ border-top: 1px solid black; }
td.displaylines {text-align:center; white-space:nowrap;}
.centerline {text-align:center;}
.rightline {text-align:right;}
pre.verbatim {font-family: monospace,monospace; text-align:left; clear:both; }
.fbox {padding-left:3.0pt; padding-right:3.0pt; text-indent:0pt; border:solid black 0.4pt; }
div.fbox {display:table}
div.center div.fbox {text-align:center; clear:both; padding-left:3.0pt; padding-right:3.0pt; text-indent:0pt; border:solid black 0.4pt; }
div.minipage{width:100%;}
div.center, div.center div.center {text-align: center; margin-left:1em; margin-right:1em;}
div.center div {text-align: left;}
div.flushright, div.flushright div.flushright {text-align: right;}
div.flushright div {text-align: left;}
div.flushleft {text-align: left;}
.underline{ text-decoration:underline; }
.underline img{ border-bottom: 1px solid black; margin-bottom:1pt; }
.framebox-c, .framebox-l, .framebox-r { padding-left:3.0pt; padding-right:3.0pt; text-indent:0pt; border:solid black 0.4pt; }
.framebox-c {text-align:center;}
.framebox-l {text-align:left;}
.framebox-r {text-align:right;}
span.thank-mark{ vertical-align: super }
span.footnote-mark sup.textsuperscript, span.footnote-mark a sup.textsuperscript{ font-size:80%; }
div.footnotes{border-top:solid 1px black; border-bottom:solid 1px black; padding-bottom:1ex; padding-top:0.5ex; margin-right:15%; margin-top:2ex; font-style:italic; font-size:85%;}
div.footnotes p{margin-top:0; margin-bottom:0; text-indent:0;}
div.tabular, div.center div.tabular {text-align: center; margin-top:0.5em; margin-bottom:0.5em; }
table.tabular td p{margin-top:0em;}
table.tabular {margin-left: auto; margin-right: auto;}
td p:first-child{ margin-top:0em; }
td p:last-child{ margin-bottom:0em; }
div.td00{ margin-left:0pt; margin-right:0pt; }
div.td01{ margin-left:0pt; margin-right:5pt; }
div.td10{ margin-left:5pt; margin-right:0pt; }
div.td11{ margin-left:5pt; margin-right:5pt; }
table[rules] {border-left:solid black 0.4pt; border-right:solid black 0.4pt; }
td.td00{ padding-left:0pt; padding-right:0pt; }
td.td01{ padding-left:0pt; padding-right:5pt; }
td.td10{ padding-left:5pt; padding-right:0pt; }
td.td11{ padding-left:5pt; padding-right:5pt; }
table[rules] {border-left:solid black 0.4pt; border-right:solid black 0.4pt; }
.hline hr, .cline hr{ height : 0px; margin:0px; }
.hline td, .cline td{ padding: 0; }
.hline hr, .cline hr{border:none;border-top:1px solid black;}
.tabbing-right {text-align:right;}
div.float, div.figure {margin-left: auto; margin-right: auto;}
div.float img {text-align:center;}
div.figure img {text-align:center;}
.marginpar,.reversemarginpar {width:20%; float:right; text-align:left; margin-left:auto; margin-top:0.5em; font-size:85%; text-decoration:underline;}
.marginpar p,.reversemarginpar p{margin-top:0.4em; margin-bottom:0.4em;}
.reversemarginpar{float:left;}
table.equation {width:100%;}
.equation td{text-align:center; }
td.equation { margin-top:1em; margin-bottom:1em; } 
td.equation-label { width:5%; text-align:center; }
td.eqnarray4 { width:5%; white-space: normal; }
td.eqnarray2 { width:5%; }
table.eqnarray-star, table.eqnarray {width:100%;}
div.eqnarray{text-align:center;}
div.array {text-align:center;}
div.pmatrix {text-align:center;}
table.pmatrix {width:100%;}
span.pmatrix img{vertical-align:middle;}
div.pmatrix {text-align:center;}
table.pmatrix {width:100%;}
span.bar-css {text-decoration:overline;}
table.tabular{border-collapse: collapse; border-spacing: 0;}
img.cdots{vertical-align:middle;}
.partToc a, .partToc, .likepartToc a, .likepartToc {line-height: 200%; font-weight:bold; font-size:110%;}
.chapterToc a, .chapterToc, .likechapterToc a, .likechapterToc, .appendixToc a, .appendixToc {line-height: 200%; font-weight:bold;}
.index-item, .index-subitem, .index-subsubitem {display:block}
div.caption {text-indent:-2em; margin-left:3em; margin-right:1em; text-align:left;}
div.caption span.id{font-weight: bold; white-space: nowrap; }
h1.partHead{text-align: center}
p.bibitem { text-indent: -2em; margin-left: 2em; margin-top:0.6em; margin-bottom:0.6em; }
p.bibitem-p { text-indent: 0em; margin-left: 2em; margin-top:0.6em; margin-bottom:0.6em; }
.paragraphHead, .likeparagraphHead { margin-top:2em; font-weight: bold;}
.subparagraphHead, .likesubparagraphHead { font-weight: bold;}
.verse{white-space:nowrap; margin-left:2em}
div.maketitle {text-align:center;}
h2.titleHead{text-align:center;}
div.maketitle{ margin-bottom: 2em; }
div.author, div.date {text-align:center;}
div.thanks{text-align:left; margin-left:10%; font-size:85%; font-style:italic; }
div.abstract p {margin-left:5%; margin-right:5%;}
div.abstract {width:100%;}
.abstracttitle{text-align:center;margin-bottom:1em;}
figure.float, div.figure {margin-left: auto; margin-right: auto;}
figure.float img, figure.figure img {display: block; margin-left: auto; margin-right: auto;}
figure.figure {text-align:center;}
figcaption.caption {text-indent:-2em; margin-left:3em; margin-right:1em; text-align:center;}
figcaption.caption span.id{font-weight: bold; white-space: nowrap; }
.abstract{margin:1em;}
dt.printshorthands{float:left; clear:left; margin-right:1em;}
dd.thebibliography {margin-left: 2.5em;}
dt.thebibliography {float:left; clear:left; margin-right:1em;}
.lstlisting .label{margin-right:0.5em; }
div.lstlisting{font-family: monospace,monospace; white-space: nowrap; margin-top:0.5em; margin-bottom:0.5em; }
div.lstinputlisting{ font-family: monospace,monospace; white-space: nowrap; }
.lstinputlisting .label{margin-right:0.5em;}
.small-caps{font-variant: small-caps;}
.uline{ text-decoration:underline; }
.uuline{ text-decoration:underline; }
span.sout {text-decoration: line-through }
span.xout {text-decoration: line-through }
span.uwave {text-decoration:underline }
/* end css.sty */

</style>
</head>
<body>
<p>Return to <a href="../">SwATips</a> | <a href="20210412.pdf">pdf</a> | <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img src="images/by.svg" width="60" height="21" alt="CC-BY" /></a></p>
<div class='maketitle'>
                                                                                         
                                                                                         
                                                                                         
                                                                                         

<h2 class='titleHead'> <strong>Software Assurance Tips</strong><br />
A product of the Software Assurance Tips Team[<a href='#cite.0@swatips'>1</a>]<br />
</h2>
<div class='author'><span class='rm-lmr-12'>Jon Hood</span></div><br />
<div class='date'><span class='rm-lmr-12'>Monday 12</span><sup class='textsuperscript'><span class='rm-lmr-9'>th</span></sup><span class='rm-lmr-12'>Â April, 2021</span></div>
</div>
                                                                                         
                                                                                         
   
<h3 class='sectionHead'><span class='titlemark'>1   </span> <a id='x1-10001'></a>Sticking with a RAII Standard</h3>
<!-- l. 43 --><p class='noindent'><span class='rm-lmr-8'>Updated Monday 30</span><sup class='textsuperscript'><span class='rm-lmr-9'>th</span></sup><span class='rm-lmr-8'>Â August, 2021</span>
</p><!-- l. 1 --><p class='indent'>   Resource Acquisition Is Initialization (RAII). When working with legacy code, variables and memory
management often do not use RAII concepts. When memory is created in an uninitialized state, developers risk the
use of uninitialized memory further down in the application data flow.
</p><!-- l. 3 --><p class='indent'>   To solve this, C++ implemented two ways of initializing new memory: <i>default</i> initialization and <i>value</i>
initialization. While default initialization is typically faster, developers quickly realized that there were rarely
reasons to keep memory uninitialized. Initializing memory as soon as itâs allocated keeps developers from shooting
themselves in the foot.
</p><!-- l. 5 --><p class='indent'>   One of the best ways to prevent memory errors is to use RAII. Particularly in exception-based code, RAII
concepts provide a memory-safe technique for resource management.[<a href='#cite.0@20210412:stroustrup2001'>2</a>] Several issues face developers when
maintaining legacy code with new programming concepts, particularly in the DoD. Legacy code is
generally void of RAII concepts and has not been built with the latest standards of safe programming
practices.
</p><!-- l. 7 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.1   </span> <a id='x1-20001.1'></a>Updating the Code</h4>
<!-- l. 9 --><p class='noindent'>The first option for maintaining legacy code in a memory-safe way is to update the code. Wrapping old pointers in
smart pointers can help make the code more maintainable.
</p>   
<!-- l. 11 -->
<p><a id='x1-2001r1'></a></p>
<p><a id='x1-2002'></a></p>   
<div id='listing-1' class='lstlisting'><span class='label'><a id='x1-2003r1'></a></span><span class='ec-lmtt-9'>boolÂ *newBoolÂ =Â newÂ bool();Â </span><br /><span class='label'><a id='x1-2004r2'></a></span><span class='ec-lmtk-10x-x-90'>if</span><span class='ec-lmtt-9'>Â (*newBool)Â </span><br /><span class='label'><a id='x1-2005r3'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â coutÂ &lt;&lt;Â "We</span><span class='ts1-lmtt9-'>'</span><span class='ec-lmtt-9'>reâ£true!"â£&lt;&lt;â£endl;Â </span><br /><span class='label'><a id='x1-2006r4'></a></span><span class='ec-lmtt-9'>elseÂ </span><br /><span class='label'><a id='x1-2007r5'></a></span><span class='ec-lmtt-9'>â£â£â£â£â£â£â£â£coutâ£&lt;&lt;â£"We</span><span class='ts1-lmtt9-'>'</span><span class='ec-lmtt-9'>reÂ false!"Â &lt;&lt;Â endl;Â </span><br /><span class='label'><a id='x1-2008r6'></a></span><span class='ec-lmtt-9'>deleteÂ newBool;</span>
<figcaption class='caption'><span class='id'>ListingÂ 1:</span><span class='content'>Non-compliant listing</span></figcaption><!-- tex4ht:label?: x1-2001r1  -->
   
</div>
<!-- l. 20 -->
<p><a id='x1-2009r2'></a></p>
<p><a id='x1-2010'></a></p>   
<div id='listing-2' class='lstlisting'><span class='label'><a id='x1-2011r1'></a></span><span class='ec-lmtk-10x-x-90'>auto</span><span class='ec-lmtt-9'>Â newBoolÂ =Â make_shared&lt;bool&gt;();Â </span><br /><span class='label'><a id='x1-2012r2'></a></span><span class='ec-lmtti-10x-x-90'>//AnotherÂ way:Â shared_ptr&lt;bool&gt;Â newBool(newÂ bool());</span><span class='ec-lmtt-9'>Â </span><br /><span class='label'><a id='x1-2013r3'></a></span><span class='ec-lmtk-10x-x-90'>if</span><span class='ec-lmtt-9'>Â (*newBool)Â </span><br /><span class='label'><a id='x1-2014r4'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â coutÂ &lt;&lt;Â "We</span><span class='ts1-lmtt9-'>'</span><span class='ec-lmtt-9'>reâ£true!"â£&lt;&lt;â£endl;Â </span><br /><span class='label'><a id='x1-2015r5'></a></span><span class='ec-lmtt-9'>elseÂ </span><br /><span class='label'><a id='x1-2016r6'></a></span><span class='ec-lmtt-9'>â£â£â£â£â£â£â£â£coutâ£&lt;&lt;â£"We</span><span class='ts1-lmtt9-'>'</span><span class='ec-lmtt-9'>reÂ false!"Â &lt;&lt;Â endl;</span>
<figcaption class='caption'><span class='id'>ListingÂ 2:</span><span class='content'>RAII-compliant listing</span></figcaption><!-- tex4ht:label?: x1-2009r1  -->
   
</div>
<!-- l. 29 --><p class='indent'>   There are several issues with updating the old code to the RAII-compliant code:
</p>     
<ol class='enumerate1'>
<li id='x1-2018x1' class='enumerate'>     
Forgetting to remove the manual memory management can cause double-free errors.
</li>     
<li id='x1-2020x2' class='enumerate'>
Updating the code can cause translation issues (eg: between default and value initialization)
</li>     
<li id='x1-2022x3' class='enumerate'>
Inconsistency can increase maintenance burdens for maintained code.
</li>     
<li id='x1-2024x4' class='enumerate'>
Deletion of arrays require special handling.</li></ol>
                                                                                         
                                                                                         
<!-- l. 37 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.2   </span> <a id='x1-30001.2'></a>Double Frees</h4>
<!-- l. 39 --><p class='noindent'>Developers can introduce double free conditions where a pointer is managed by both a smart pointer and in the
code itself. Also, conditions arise when a single pointer is handed over to multiple smart pointers for
management.
</p><!-- l. 41 --><p class='indent'>   At the time of this writing, the latest versions of Fortify, Coverity, Checkmarx, Parasoft, clang-analyzer,
and the GCC 10 <span class='ec-lmtt-10'>-fanalyzer </span>flag are all incapable of identifying the double free in Listings <a href='#x1-3001r3'>3<!-- tex4ht:ref: lst:20210412:1  --></a> and
<a href='#x1-3007r4'>4<!-- tex4ht:ref: lst:20210412:2  --></a>.
</p>   
<!-- l. 43 -->
<p><a id='x1-3001r3'></a></p>
<p><a id='x1-3002'></a></p>   
<div id='listing-3' class='lstlisting'><span class='label'><a id='x1-3003r1'></a></span><span class='ec-lmtt-9'>boolÂ *newBoolÂ =Â newÂ bool();Â </span><br /><span class='label'><a id='x1-3004r2'></a></span><span class='ec-lmtt-9'>shared_ptr&lt;bool&gt;Â test1Â (newBool);Â </span><br /><span class='label'><a id='x1-3005r3'></a></span><span class='ec-lmtt-9'>shared_ptr&lt;bool&gt;Â test2Â (newBool);Â </span><br /><span class='label'><a id='x1-3006r4'></a></span><span class='ec-lmtti-10x-x-90'>//...</span>
<figcaption class='caption'><span class='id'>ListingÂ 3:</span><span class='content'>Double Smart Pointer</span></figcaption><!-- tex4ht:label?: x1-3001r1  -->
   
</div>
<!-- l. 50 -->
<p><a id='x1-3007r4'></a></p>
<p><a id='x1-3008'></a></p>   
<div id='listing-4' class='lstlisting'><span class='label'><a id='x1-3009r1'></a></span><span class='ec-lmtt-9'>boolÂ *newBoolÂ =Â newÂ bool();Â </span><br /><span class='label'><a id='x1-3010r2'></a></span><span class='ec-lmtt-9'>shared_ptr&lt;bool&gt;Â test1Â (newBool);Â </span><br /><span class='label'><a id='x1-3011r3'></a></span><span class='ec-lmtti-10x-x-90'>//...</span><span class='ec-lmtt-9'>Â </span><br /><span class='label'><a id='x1-3012r4'></a></span><span class='ec-lmtt-9'>deleteÂ newBool;</span>
<figcaption class='caption'><span class='id'>ListingÂ 4:</span><span class='content'>Smart and Dumb Pointer</span></figcaption><!-- tex4ht:label?: x1-3007r1  -->
   
</div>
<!-- l. 57 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.3   </span> <a id='x1-40001.3'></a>Initialization Errors</h4>
<!-- l. 59 --><p class='noindent'>Weâve also seen a large number of initialization errors when updating to smart pointers. Using the
above examples, itâs tempting for a developer to use shortcuts and commit the error demonstrated in
ListingÂ <a href='#x1-4001r5'>5<!-- tex4ht:ref: lst:20210412:3  --></a>.
</p>   
<!-- l. 61 -->
<p><a id='x1-4001r5'></a></p>
<p><a id='x1-4002'></a></p>   
<div id='listing-5' class='lstlisting'><span class='label'><a id='x1-4003r1'></a></span><span class='ec-lmtt-9'>shared_ptr&lt;bool&gt;Â test1Â (newÂ bool);Â </span><br /><span class='label'><a id='x1-4004r2'></a></span><span class='ec-lmtt-9'>coutÂ &lt;&lt;Â "Test1Â is:Â "Â &lt;&lt;Â *test1Â &lt;&lt;Â endl;</span>
<figcaption class='caption'><span class='id'>ListingÂ 5:</span><span class='content'>Uninitialized Boolean</span></figcaption><!-- tex4ht:label?: x1-4001r1  -->
   
</div>
<!-- l. 66 --><p class='indent'>   The unpredictable nature of this issue can be demonstrated in the example in ListingÂ <a href='#x1-4005r6'>6<!-- tex4ht:ref: lst:20210412:4  --></a> where the Boolean uses
default initialization and obtains a random value from previously-freed memory.
</p>   
<!-- l. 68 -->
<p><a id='x1-4005r6'></a></p>
<p><a id='x1-4006'></a></p>   
<div id='listing-6' class='lstlisting'><span class='label'><a id='x1-4007r1'></a></span><span class='ec-lmtk-10x-x-90'>#include</span><span class='ec-lmtt-9'>Â &lt;climits&gt;Â </span><br /><span class='label'><a id='x1-4008r2'></a></span><span class='ec-lmtk-10x-x-90'>#include</span><span class='ec-lmtt-9'>Â &lt;iostream&gt;Â </span><br /><span class='label'><a id='x1-4009r3'></a></span><span class='ec-lmtk-10x-x-90'>#include</span><span class='ec-lmtt-9'>Â &lt;memory&gt;Â </span><br /><span class='label'><a id='x1-4010r4'></a></span><span class='ec-lmtk-10x-x-90'>#include</span><span class='ec-lmtt-9'>Â &lt;random&gt;Â </span><br /><span class='label'><a id='x1-4011r5'></a></span><span class='ec-lmtt-9'>usingÂ namespaceÂ std;Â </span><br /><span class='label'><a id='x1-4012r6'></a></span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>Â main()Â </span><br /><span class='label'><a id='x1-4013r7'></a></span><span class='ec-lmtt-9'>{Â </span><br /><span class='label'><a id='x1-4014r8'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â random_deviceÂ rd;Â </span><br /><span class='label'><a id='x1-4015r9'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â mt19937Â gen(rd());Â </span><br /><span class='label'><a id='x1-4016r10'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â uniform_int_distribution&lt;&gt;Â distrib(INT_MIN,Â INT_MAX);Â </span><br /><span class='label'><a id='x1-4017r11'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â vector&lt;</span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>*&gt;Â deleteLater;Â </span><br /><span class='label'><a id='x1-4018r12'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>for</span><span class='ec-lmtt-9'>Â (</span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>Â iÂ =Â 0;Â iÂ &lt;Â 100;Â i++)Â </span><br /><span class='label'><a id='x1-4019r13'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â {Â </span><br /><span class='label'><a id='x1-4020r14'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>Â *deleteMeÂ =Â newÂ </span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>;Â </span><br /><span class='label'><a id='x1-4021r15'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â *deleteMeÂ =Â distrib(gen);Â </span><br /><span class='label'><a id='x1-4022r16'></a></span><span class='ec-lmtti-10x-x-90'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //deleteÂ someÂ memoryÂ now</span><span class='ec-lmtt-9'>Â </span><br /><span class='label'><a id='x1-4023r17'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>if</span><span class='ec-lmtt-9'>Â (*deleteMeÂ &gt;Â 0)Â </span><br /><span class='label'><a id='x1-4024r18'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â deleteÂ deleteMe;Â </span><br /><span class='label'><a id='x1-4025r19'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>else</span><span class='ec-lmtt-9'>Â </span><br /><span class='label'><a id='x1-4026r20'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â deleteLater.push_back(deleteMe);Â </span><br /><span class='label'><a id='x1-4027r21'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â }Â </span><br /><span class='label'><a id='x1-4028r22'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â shared_ptr&lt;bool&gt;Â newBool(newÂ bool);Â </span><br /><span class='label'><a id='x1-4029r23'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â coutÂ &lt;&lt;Â "Value:Â "Â &lt;&lt;Â *newBoolÂ &lt;&lt;Â endl;Â </span><br /><span class='label'><a id='x1-4030r24'></a></span><span class='ec-lmtti-10x-x-90'>Â Â Â Â Â Â Â Â //deleteÂ someÂ memoryÂ later</span><span class='ec-lmtt-9'>Â </span><br /><span class='label'><a id='x1-4031r25'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>for</span><span class='ec-lmtt-9'>Â (</span><span class='ec-lmtk-10x-x-90'>int</span><span class='ec-lmtt-9'>Â *nÂ :Â deleteLater)Â </span><br /><span class='label'><a id='x1-4032r26'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â deleteÂ n;Â </span><br /><span class='label'><a id='x1-4033r27'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â </span><span class='ec-lmtk-10x-x-90'>return</span><span class='ec-lmtt-9'>Â 0;Â </span><br /><span class='label'><a id='x1-4034r28'></a></span><span class='ec-lmtt-9'>}</span>
<figcaption class='caption'><span class='id'>ListingÂ 6:</span><span class='content'>Uninitialized Boolean</span></figcaption><!-- tex4ht:label?: x1-4005r1  -->
   
</div>
                                                                                         
                                                                                         
<!-- l. 99 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.4   </span> <a id='x1-50001.4'></a>Inconsistency Can Increase Maintenance Costs</h4>
<!-- l. 101 --><p class='noindent'>Consider updated code that uses a multitude of different memory handling methods. Some memory is managed
manually using <span class='ec-lmtt-10'>malloc </span>and <span class='ec-lmtt-10'>free</span>. Some pass the previous pointer values to smart pointers for their management.
Others have been updated to use the <span class='ec-lmtt-10'>make_shared </span>construct. Still others have been updated to custom classes and
structs.
</p><!-- l. 103 --><p class='indent'>   Consistency is more important than updating. Introducing multiple memory handling patterns to a section of
code increases its complexity. If old memory handling methods cannot be replaced or are not planned to be replaced,
it may make more sense to stick with confusing (but consistent) code rather than adding additional
complexity.
</p><!-- l. 105 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.5   </span> <a id='x1-60001.5'></a>Smart Pointers and Arrays</h4>
<!-- l. 107 --><p class='noindent'>Finally, some special considerations are needed for allowing smart pointers to handle arrays. The <span class='ec-lmtt-10'>shared_ptr</span>
construct permits the developer to define a custom deleter like the one for this array of 10 Booleans:
</p>   
<!-- l. 109 -->
<p><a id='x1-6001r7'></a></p>
<p><a id='x1-6002'></a></p>   
<div id='listing-7' class='lstlisting'><span class='label'><a id='x1-6003r1'></a></span><span class='ec-lmtt-9'>shared_ptr&lt;bool&gt;Â test1{Â </span><br /><span class='label'><a id='x1-6004r2'></a></span><span class='ec-lmtt-9'>Â Â Â Â Â Â Â Â newÂ bool[10],Â [](</span><span class='ec-lmtk-10x-x-90'>const</span><span class='ec-lmtt-9'>Â boolÂ *ptr)Â {Â deleteÂ []Â ptr;Â }Â </span><br /><span class='label'><a id='x1-6005r3'></a></span><span class='ec-lmtt-9'>};</span>
<figcaption class='caption'><span class='id'>ListingÂ 7:</span><span class='content'>Custom Deleter</span></figcaption><!-- tex4ht:label?: x1-6001r1  -->
   
</div>
<!-- l. 115 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.6   </span> <a id='x1-70001.6'></a>Conclusion</h4>
<!-- l. 117 --><p class='noindent'>Smart pointers and RAII concepts help developers prevent memory errors that can plague software. Updating legacy
code to RAII concepts can increase its maintainability, usefulness, and security. Nevertheless, updates to the code
should not come at a price of inconsistency. When updates can only be applied partially or introduce additional
complexity, consistency should be preferred.
                                                                                         
                                                                                         
</p>   
<h3 class='sectionHead'><a id='x1-80001.6'></a>References</h3>
<!-- l. 48 --><p class='noindent'>    
</p>
<dl class='thebibliography'><dt id='X0-swatips' class='thebibliography'>
[1]  
</dt><dd id='bib-1' class='thebibliography'>
<!-- l. 48 --><p class='noindent'><a id='cite.0@swatips'></a>Jon Hood, ed. SwATips. <a href='https://www.SwATips.com/' class='url'><span class='ec-lmtt-10'>https://www.SwATips.com/</span></a>.
</p>    
</dd>
<dt id='X0-20210412:stroustrup2001' class='thebibliography'>
[2]  
</dt><dd id='bib-2' class='thebibliography'>
<!-- l. 48 --><p class='noindent'><a id='cite.0@20210412:stroustrup2001'></a>Bjarne    Stroustrup.    âException    Safety:    Concepts    and    Techniquesâ.    In:    (2001).    <span class='small-caps'>url</span>:
<a href='https://www.stroustrup.com/except.pdf' class='url'><span class='ec-lmtt-10'>https://www.stroustrup.com/except.pdf</span></a>.</p></dd></dl>
 
</body> 
</html>