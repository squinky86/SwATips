<!DOCTYPE html> 
<html xml:lang='en-US' lang='en-US'> 
<head><title>Heap Inspection</title> 
<meta charset='utf-8' /> 
<meta name='generator' content='TeX4ht (http://www.tug.org/tex4ht/)' /> 
<meta name='viewport' content='width=device-width,initial-scale=1' /> 
<link type='text/css' href='article.css' rel='stylesheet' /> 
<meta name='src' content='article.tex' /> 
</head><body>
<p>Return to <a href="../">SwATips</a> | <a href="20210419.pdf">pdf</a></p>
<div class='maketitle'>
                                                                                         
                                                                                         
                                                                                         
                                                                                         

<h2 class='titleHead'> <strong>Software Assurance Tips</strong><br />
A product of the Software Assurance Tips Team[<a id='page.3'></a><a href='article.html#X0-swatips'>2</a>]<br />
Generated Tuesday 20<sup class='textsuperscript'>th</sup> April, 2021</h2>
<div class='author'><span class='rm-lmr-12'>Andrew Perry</span></div><br />
<div class='date'><span class='rm-lmr-12'>Monday 19</span><sup class='textsuperscript'><span class='rm-lmr-9'>th</span></sup><span class='rm-lmr-12'> April, 2021</span></div>
</div>
                                                                                         
                                                                                         
   
<h3 class='sectionHead'><span class='titlemark'>1   </span> <a id='x1-10001'></a>Heap Inspection</h3>
<!-- l. 1 --><p class='noindent'>One of the first findings that I found when I began validating software assurance scans and something that intrigued
me to learn more about was <i>Heap Inspections</i>.[<a id='page.4'></a><a href='article.html#X0-20210419-cwe-244'>1</a>] In order to know how to resolve this issue, there are some things to
understand about how heap is used in RAM in order to see how this vulnerability plays out and ways to fix
it.
</p><!-- l. 3 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.1   </span> <a id='x1-20001.1'></a>What is Heap?</h4>
<!-- l. 5 --><p class='noindent'>When we declare a variable in an application, it allocates some memory in RAM. A stack is an array of memory
that stores variables and implements a block allocation that is reserved in a LIFO (Last in, First out). When data
are written, the stack trends downwards towards the heap. The heap is a location in memory that a program can
use to store data in some various amount that may not be known until the program is running. Heap trends
upwards when data is passed whereas a stack trends in a downward direction. When creating an object string that
points to the stack memory, its value is stored in the heap. Heap is different than stack in that it is dynamically
stored in memory which means that it can be stored and removed in any order. If the heap has data that has
a fixed length memory block, it will overwrite expired or free values that were originally stored.[<a href='article.html#X0-20210419-guru99'>5</a>,
<a href='article.html#X0-20210419-indika'>3</a>]
</p><!-- l. 7 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.2   </span> <a id='x1-30001.2'></a>What is Heap Inspection?</h4>
<!-- l. 9 --><p class='noindent'>In the case of a Heap Inspection, when information is stored in machine memory that is unencrypted and is using a
<span class='ec-lmtt-10'>realloc() </span>function to increase the size of the block of allocated memory, an attacker can perform a memory dump
that could compromise the system. This can cause all kinds of problems such as crash the program, but it can also
expose sensitive information because it is not removed from memory properly. There are some ways to help mitigate
this issue in C# or .NET applications.
</p><!-- l. 11 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.3   </span> <a id='x1-40001.3'></a>Heap Inspection Prevention</h4>
<!-- l. 13 --><p class='noindent'>Using the <span class='ec-lmtt-10'>String </span>object should not be used if the information contains sensitive information such as a password,
credit card number, etc. It is important to not allow plain text passwords; hash them with a crytographically secure
hasing algorithm. An important note is to invoke a Disposable method to use as a garbage collector to
free computer memory when an object is no longer needed. One of the ways you can avoid a heap
inspection and to protect sensitive data is by using a <span class='ec-lmtt-10'>SecureString</span>. Consider the code in Listing <a href='#x1-4001r1'>1<!-- tex4ht:ref: fig:20210419:1  --></a>.[<a href='article.html#X0-20210419-codeproject'>6</a>,
<a href='article.html#X0-20210419-swain'>4</a>]
</p>   
<!-- l. 15 -->
<p><a id='x1-4001r1'></a></p>
<p><a id='x1-4002'></a></p>   
<div class='lstlisting' id='listing-1'><span class='label'><a id='x1-4003r1'></a></span><span class='ec-lmtt-9'>SecureString securePwd = </span><span class='ec-lmtk-10x-x-90'>new</span><span class='ec-lmtt-9'> SecureString(); </span><br /><span class='label'><a id='x1-4004r2'></a></span><span class='ec-lmtt-9'>ConsoleKeyInfo key; </span><br /><span class='label'><a id='x1-4005r3'></a></span><span class='ec-lmtt-9'>Console.Write("Enter password: "); </span><br /><span class='label'><a id='x1-4006r4'></a></span><span class='ec-lmtk-10x-x-90'>do</span><span class='ec-lmtt-9'> { </span><br /><span class='label'><a id='x1-4007r5'></a></span><span class='ec-lmtt-9'>        key = Console.ReadKey(</span><span class='ec-lmtk-10x-x-90'>true</span><span class='ec-lmtt-9'>);…</span>
<figcaption class='caption'><span class='id'>Listing 1:</span><span class='content'>SecureString Example</span></figcaption><!-- tex4ht:label?: x1-4001r1  -->
   
</div>
                                                                                         
                                                                                         
<!-- l. 24 --><p class='noindent'>
</p>   
<h4 class='subsectionHead'><span class='titlemark'>1.4   </span> <a id='x1-50001.4'></a>Conclusion</h4>
<!-- l. 26 --><p class='noindent'>In conclusion, avoiding this issue can be a challenge, if not impossible. However, it’s important that if this finding
has been found in a static analysis scan, it should not be marked as a false positive, particularly if the code
could ever be placed in a shared environment. Doing so may allow the code to go unnoticed while
it continues to have unintended results and could allow sensitive information to be obtained by an
adversary.
                                                                                         
                                                                                         
</p>   
<h3 class='sectionHead'><a id='x1-60001.4'></a>References</h3>
<!-- l. 49 --><p class='noindent'>    
</p>
<dl class='thebibliography'><dt id='X0-20210419-cwe-244' class='thebibliography'>
[1]  
</dt><dd id='bib-1' class='thebibliography'>
<!-- l. 49 --><p class='noindent'><a id='page.6'></a><a id='X0-' href='article.html'></a>CWE  Content  Team.  “CWE-244:  Improper  Clearing  of  Heap  Memory  Before  Release  (’Heap
Inspection’)”. In: (2020). <span class='small-caps'>url</span>: <a class='url' href='https://cwe.mitre.org/data/definitions/244.html'><span class='ec-lmtt-10'>https://cwe.mitre.org/data/definitions/244.html</span></a>.
</p>    
</dd>
<dt id='X0-swatips' class='thebibliography'>
[2]  
</dt><dd id='bib-2' class='thebibliography'>
<!-- l. 49 --><p class='noindent'>Jon Hood, ed. <span class='rm-lmri-10'>SwATips</span>. <a class='url' href='https://www.SwATips.com/'><span class='ec-lmtt-10'>https://www.SwATips.com/</span></a>.
</p>    
</dd>
<dt id='X0-20210419-indika' class='thebibliography'>
[3]  
</dt><dd id='bib-3' class='thebibliography'>
<!-- l. 49 --><p class='noindent'>Indika.        “Difference        Between        Stack        and        Heap”.        In:        (2011).        <span class='small-caps'>url</span>:
<a class='url' href='https://www.differencebetween.com/difference-between-stack-and-vs-heap/'><span class='ec-lmtt-10'>https://www.differencebetween.com/difference-between-stack-and-vs-heap/</span></a>.
</p>    
</dd>
<dt id='X0-20210419-swain' class='thebibliography'>
[4]  
</dt><dd id='bib-4' class='thebibliography'>
<!-- l. 49 --><p class='noindent'>Chittaranjan Swain. “How to fix heap inspection vulnerability in c#”. In: (2019). <span class='small-caps'>url</span>: <a class='url' href='https://www.c-sharpcorner.com/forums/how-to-fix-heap-inspection-vulnerability-in-c-sharp'><span class='ec-lmtt-10'>https://www.c-sharpcorner.com/forums/how-to-fix-heap-inspection-vulnerability-in-c-sharp</span></a>.
</p>    
</dd>
<dt id='X0-20210419-guru99' class='thebibliography'>
[5]  
</dt><dd id='bib-5' class='thebibliography'>
<!-- l. 49 --><p class='noindent'>Unknown.       “Stack       vs       Heap:       Know       the       Difference”.       In:       ().       <span class='small-caps'>url</span>:
<a class='url' href='https://www.guru99.com/stack-vs-heap.html'><span class='ec-lmtt-10'>https://www.guru99.com/stack-vs-heap.html</span></a>.
</p>    
</dd>
<dt id='X0-20210419-codeproject' class='thebibliography'>
[6]  
</dt><dd id='bib-6' class='thebibliography'>
<!-- l. 49 --><p class='noindent'>Unknown. “To Avoid Heap Inspection”. In: (2015). <span class='small-caps'>url</span>: <a class='url' href='https://www.codeproject.com/Questions/1039781/To-Avoid-Heap-Inspection-I-Used-Securestring-Inste'><span class='ec-lmtt-10'>https://www.codeproject.com/Questions/1039781/To-Avoid-Heap-Inspection-I-Used-Securestring-Inste</span></a>.</p></dd></dl>
 
</body> 
</html>